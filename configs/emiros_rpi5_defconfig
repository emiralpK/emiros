# EmiROS Buildroot Configuration for Raspberry Pi 5
# Architecture: aarch64 (ARM64)
# Features: X11 + XFCE4 Desktop + BusyBox httpd + Web Dashboard

# Target architecture
BR2_aarch64=y
BR2_cortex_a76=y

# Toolchain
BR2_TOOLCHAIN_EXTERNAL=y
BR2_TOOLCHAIN_EXTERNAL_BOOTLIN=y
BR2_TOOLCHAIN_EXTERNAL_BOOTLIN_AARCH64_GLIBC_STABLE=y

# System configuration
BR2_TARGET_GENERIC_HOSTNAME="emiros"
BR2_TARGET_GENERIC_ISSUE="Welcome to EmiROS"
BR2_TARGET_GENERIC_ROOT_PASSWD="emiros"
BR2_SYSTEM_DHCP="eth0"
BR2_ROOTFS_OVERLAY="$(BR2_EXTERNAL_EMIROS_PATH)/rootfs_overlay"
BR2_ROOTFS_POST_BUILD_SCRIPT="$(BR2_EXTERNAL_EMIROS_PATH)/scripts/post-build.sh"

# Init system - BusyBox init
BR2_INIT_BUSYBOX=y
BR2_PACKAGE_BUSYBOX_CONFIG="package/busybox/busybox.config"

# Kernel
BR2_LINUX_KERNEL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL=y
BR2_LINUX_KERNEL_CUSTOM_TARBALL_LOCATION="https://github.com/raspberrypi/linux/archive/refs/tags/1.20231123.tar.gz"
BR2_LINUX_KERNEL_USE_CUSTOM_CONFIG=y
BR2_LINUX_KERNEL_CUSTOM_CONFIG_FILE="$(BR2_EXTERNAL_EMIROS_PATH)/configs/kernel.config"
BR2_LINUX_KERNEL_DTS_SUPPORT=y
BR2_LINUX_KERNEL_INTREE_DTS_NAME="broadcom/bcm2712-rpi-5-b"
BR2_LINUX_KERNEL_NEEDS_HOST_OPENSSL=y

# Bootloader - Raspberry Pi firmware
BR2_TARGET_ARM_TRUSTED_FIRMWARE=y
BR2_TARGET_ARM_TRUSTED_FIRMWARE_CUSTOM_GIT=y
BR2_TARGET_ARM_TRUSTED_FIRMWARE_CUSTOM_REPO_URL="https://github.com/raspberrypi/arm-trusted-firmware.git"
BR2_TARGET_ARM_TRUSTED_FIRMWARE_PLATFORM="rpi5"

# Raspberry Pi firmware files
BR2_PACKAGE_RPI_FIRMWARE=y
BR2_PACKAGE_RPI_FIRMWARE_VARIANT_PI5=y
BR2_PACKAGE_RPI_FIRMWARE_X=y

# X11 Server (Xorg)
BR2_PACKAGE_XORG7=y
BR2_PACKAGE_XSERVER_XORG_SERVER=y
BR2_PACKAGE_XSERVER_XORG_SERVER_MODULAR=y
BR2_PACKAGE_XDRIVER_XF86_VIDEO_FBDEV=y
BR2_PACKAGE_XDRIVER_XF86_INPUT_EVDEV=y
BR2_PACKAGE_XDRIVER_XF86_INPUT_KEYBOARD=y
BR2_PACKAGE_XDRIVER_XF86_INPUT_MOUSE=y

# X11 libraries
BR2_PACKAGE_LIBERATION=y
BR2_PACKAGE_XLIB_LIBX11=y
BR2_PACKAGE_XLIB_LIBXEXT=y
BR2_PACKAGE_XLIB_LIBXFT=y
BR2_PACKAGE_XLIB_LIBXRENDER=y

# XFCE4 Desktop Environment
BR2_PACKAGE_XFCE4=y
BR2_PACKAGE_LIBXFCE4UI=y
BR2_PACKAGE_LIBXFCE4UTIL=y
BR2_PACKAGE_XFCE4_PANEL=y
BR2_PACKAGE_XFCE4_SESSION=y
BR2_PACKAGE_XFCE4_SETTINGS=y
BR2_PACKAGE_XFCE4_TERMINAL=y
BR2_PACKAGE_XFCE4_TASKMANAGER=y
BR2_PACKAGE_XFCONF=y
BR2_PACKAGE_XFDESKTOP=y
BR2_PACKAGE_XFWM4=y
BR2_PACKAGE_THUNAR=y

# Display Manager - LightDM
BR2_PACKAGE_LIGHTDM=y
BR2_PACKAGE_LIGHTDM_GTK_GREETER=y

# Desktop utilities
BR2_PACKAGE_DBUS=y
BR2_PACKAGE_DBUS_GLIB=y
BR2_PACKAGE_CONSOLEKIT2=y

# Network
BR2_PACKAGE_DHCPCD=y
BR2_PACKAGE_ETHTOOL=y
BR2_PACKAGE_IPROUTE2=y
BR2_PACKAGE_IPTABLES=y
BR2_PACKAGE_WGET=y
BR2_PACKAGE_DROPBEAR=y

# System utilities
BR2_PACKAGE_HTOP=y
BR2_PACKAGE_NANO=y
BR2_PACKAGE_VIM=y

# Filesystem utilities
BR2_PACKAGE_E2FSPROGS=y
BR2_PACKAGE_DOSFSTOOLS=y

# Graphics and multimedia
BR2_PACKAGE_MESA3D=y
BR2_PACKAGE_MESA3D_GALLIUM_DRIVER_VC4=y
BR2_PACKAGE_MESA3D_OPENGL_EGL=y

# Target filesystem
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_SIZE="512M"

# Bootloader config files
BR2_ROOTFS_POST_IMAGE_SCRIPT="support/scripts/genimage.sh"
BR2_ROOTFS_POST_SCRIPT_ARGS="-c $(BR2_EXTERNAL_EMIROS_PATH)/board/genimage.cfg"

# Enable toolchain in target
BR2_PACKAGE_HOST_GDB=y
BR2_PACKAGE_GDB=y

# Additional packages
BR2_PACKAGE_CA_CERTIFICATES=y
