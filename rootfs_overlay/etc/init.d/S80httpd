#!/bin/sh
# S80httpd - BusyBox HTTP server for web dashboard

HTTPD=/usr/sbin/httpd
HTTPD_PORT=80
HTTPD_HOME=/var/www
HTTPD_CONF=/etc/httpd.conf

case "$1" in
    start)
        echo "Starting web server on port $HTTPD_PORT..."
        
        # Create necessary directories
        mkdir -p "$HTTPD_HOME"
        mkdir -p "$HTTPD_HOME/cgi-bin"
        
        # Make CGI scripts executable
        chmod +x "$HTTPD_HOME/cgi-bin/"* 2>/dev/null || true
        
        # Start httpd
        if [ -x "$HTTPD" ]; then
            $HTTPD -p $HTTPD_PORT -h $HTTPD_HOME -c $HTTPD_CONF
            echo "Web server started at http://localhost:$HTTPD_PORT"
        else
            echo "httpd not found"
        fi
        ;;
    stop)
        echo "Stopping web server..."
        killall httpd 2>/dev/null || true
        ;;
    restart|reload)
        "$0" stop
        sleep 1
        "$0" start
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
esac

exit 0
